<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      /* å°†è¿™ä¸ªå…ƒç´ è®¾ä¸ºflexå®¹å™¨ */
      flex-direction: column;
      /* è®¾ç½®å­å…ƒç´ æ²¿ç«–ç›´æ–¹å‘æ’åˆ— */
      align-items: center;
      /* è®©æ‰€æœ‰å­å…ƒç´ åœ¨ã€Œäº¤å‰è½´ã€æ–¹å‘ä¸Šå±…ä¸­å¯¹é½ã€‚ */
      padding: 100px;
    }

    h1 {
      margin-bottom: 20px;
    }

    .puzzle {
      width: 300px;
      height: 300px;
      display: flex;
      flex-wrap: wrap;
      /* å…è®¸å­å…ƒç´ æ¢è¡Œæ’åˆ—ï¼Œè€Œä¸æ˜¯é»˜è®¤åœ°ä¸€è¡ŒæŒ¤åˆ°åº• */
      border: 2px solid #333;
      position: relative;
    }

    .tile {
      width: 100px;
      height: 100px;
      box-sizing: border-box;
      /* è®©å…ƒç´ çš„ å®½åº¦å’Œé«˜åº¦åŒ…å«äº†è¾¹æ¡†å’Œå†…è¾¹è·ï¼Œé¿å…è®¾ç½®å®½é«˜æ—¶å…ƒç´ å®é™…å°ºå¯¸å˜å¤§ã€‚ */
      border: 1px solid #ccc;
      background-image: url('./images/Ecust.jpg');
      background-size: 300px 300px;
      cursor: pointer;
      /* é¼ æ ‡æ‚¬åœåœ¨å…ƒç´ ä¸Šæ—¶ï¼Œæ˜¾ç¤ºâ€œæ‰‹æŒ‡â€æ ·å¼ï¼Œè¡¨ç¤ºè¿™ä¸ªå…ƒç´ æ˜¯å¯ç‚¹å‡»çš„ã€‚ */
      transition: border 0.2s;
      /* å½“å…ƒç´ çš„è¾¹æ¡†å±æ€§å˜åŒ–æ—¶ï¼Œè¿‡æ¸¡åŠ¨ç”»æŒç»­ 0.2 ç§’ï¼Œæ•ˆæœæ›´å¹³æ»‘ã€‚ */
    }

    .tile.selected {
      border: 2px solid #f00;
      /* å½“ tile è¢«é€‰ä¸­æ—¶ï¼Œè¾¹æ¡†å˜ä¸ºçº¢è‰² */
    }

    .message {
      margin-top: 20px;
      font-size: 1.2em;
      color: green;
    }

    .btn {
      margin-top: 10px;
      padding: 8px 16px;
      font-size: 1em;
      cursor: pointer;
      background-color: #5b636b;
      color: white;
      border: none;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <h1>æ‹¼å›¾å°æ¸¸æˆ</h1>
  <div class="puzzle" id="puzzle"></div>
  <div class="message" id="message"></div>
  <button class="btn" onclick="shuffleTiles()">é‡æ–°å¼€å§‹</button>
  <script>
    const puzzle = document.getElementById('puzzle');
    const message = document.getElementById('message');
    const size = 3; // æ‹¼å›¾çš„è¡Œåˆ—æ•°
    const totalTiles = size * size; // æ‹¼å›¾çš„æ€»å—æ•°
    let tiles = [];
    let selected = [];
    let draggedTile = null;
    // ç”Ÿæˆæ‹¼å›¾å—
    function createTiles() {
      tiles = [];
      for (let i = 0; i < totalTiles; i++) {
        const tile = document.createElement('div');
        tile.classList.add('tile');
        tile.dataset.index = i;
        // ç›¸å½“äºç»™å…ƒç´ æ·»åŠ å±æ€§ data-index="i"
        const row = Math.floor(i / size)
        const col = i % size;
        tile.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
        // ä¹˜ä»¥ 100 è¡¨ç¤ºæ¯ä¸ª tile çš„å°ºå¯¸æ˜¯ 100pxï¼ˆå®½é«˜ï¼‰ã€‚
        // å–è´Ÿå€¼ - æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³æŠŠèƒŒæ™¯å›¾å¾€å·¦å’Œå¾€ä¸Šç§»åŠ¨ï¼Œä»è€Œåªæ˜¾ç¤ºèƒŒæ™¯å›¾çš„æŸä¸ªéƒ¨åˆ†ã€‚
        // tile.addEventListener('click', () =>
        //   selectTile(tile));
        // // å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ª tile æ—¶ï¼Œä¼šè°ƒç”¨å‡½æ•° selectTileï¼Œå¹¶æŠŠå½“å‰ç‚¹å‡»çš„ tile ä½œä¸ºå‚æ•°ä¼ è¿›å»
        // // è¿™é‡Œæ˜¯ç®­å¤´å†™æ³•
        // tiles.push(tile);
        // æŠŠè¿™ä¸ª tile æ·»åŠ è¿›ä¸ªæ•°ç»„ tilesï¼š
        // è®©æ‹¼å›¾å—å¯æ‹–æ‹½
        tile.setAttribute('draggable', true);
        // è®©è¯¥ DOM å…ƒç´ å˜å¾—å¯ä»¥è¢«æ‹–åŠ¨ï¼ˆé»˜è®¤ <div> æ˜¯ä¸å¯æ‹–åŠ¨çš„ï¼‰ã€‚
        // ç­‰æ•ˆäº HTML å†™æ³•ï¼š<div draggable="true">

        // ç»‘å®šæ‹–æ‹½å¼€å§‹äº‹ä»¶
        tile.addEventListener('dragstart', (e) => {
          draggedTile = tile;
          e.dataTransfer.effectAllowed = 'move';
        });

        // æ‹–æ‹½ç»è¿‡æ—¶å…è®¸æ”¾ç½®
        tile.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
        });

        // æ”¾ç½®äº‹ä»¶ï¼Œäº¤æ¢ä½ç½®
        tile.addEventListener('drop', (e) => {
          e.preventDefault();
          if (draggedTile && draggedTile !== tile) {
            swapTiles(draggedTile, tile);
            checkWin();
          }
          draggedTile = null;
        });

        tiles.push(tile);
      }
    }

    function shuffleTiles() {
      message.textContent = '';
      // æ¸…ç©ºé¡µé¢ä¸­çš„æç¤ºä¿¡æ¯
      createTiles();
      for (let i = tiles.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        // ç”Ÿæˆä¸€ä¸ªéšæœºæ•° jï¼ŒèŒƒå›´æ˜¯ 0 åˆ° iï¼ˆåŒ…æ‹¬ iï¼‰
        [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
        // Fisher-Yates æ´—ç‰Œç®—æ³•ï¼Œç”¨æ¥éšæœºæ‰“ä¹±æ•°ç»„é¡ºåºã€‚
        // äº¤æ¢ tiles[i] å’Œ tiles[j] çš„ä½ç½®
      }
      renderTiles();
      // è°ƒç”¨ renderTiles å‡½æ•°æ¥é‡æ–°æ¸²æŸ“æ‹¼å›¾å— 
    }

    function renderTiles() {
      puzzle.innerHTML = '';
      tiles.forEach(tile => {
        puzzle.appendChild(tile);
        // æŠŠæ¯ä¸ª tile æ·»åŠ åˆ°æ‹¼å›¾å®¹å™¨ä¸­
        // push æ˜¯æ•°ç»„æ–¹æ³•ï¼Œåªä¼šæŠŠå…ƒç´ åŠ å…¥æ•°ç»„ä¸­ï¼Œä¸ä¼šå½±å“ DOM ç»“æ„ï¼Œé¡µé¢ä¸ä¼šå˜åŒ–ã€‚
      });
    }

    function selectTile(tile) {
      if (selected.length === 0) {
        tile.classList.add('selected');
        // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„ tileï¼Œå°±æŠŠå½“å‰ tile æ ‡è®°ä¸ºé€‰ä¸­
        selected.push(tile);
        // æŠŠå½“å‰ tile æ·»åŠ åˆ° selected æ•°ç»„ä¸­        
      }
      else if (selected.length === 1 && selected[0] !== tile) {
        // å¦‚æœå·²ç»é€‰ä¸­äº†ä¸€ä¸ª tileï¼Œå¹¶ä¸”å½“å‰ tile ä¸æ˜¯ä¹‹å‰é€‰ä¸­çš„é‚£ä¸ª
        tile.classList.add('selected');
        // æŠŠå½“å‰ tile æ ‡è®°ä¸ºé€‰ä¸­
        selected.push(tile);
        // æŠŠå½“å‰ tile æ·»åŠ åˆ° selected æ•°ç»„ä¸­

        // äº¤æ¢ä¸¤ä¸ªæ‹¼å›¾å—
        swapTiles(selected[0], selected[1]);

        // æ¸…é™¤é€‰ä¸­æ ·å¼å’Œæ•°ç»„ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡é€‰æ‹©
        selected.forEach(t => t.classList.remove('selected'));
        selected = [];
        checkWin();
      }
    }
    function swapTiles(tile1, tile2) {
      const index1 = tiles.indexOf(tile1);
      const index2 = tiles.indexOf(tile2);
      // è·å– tile1 å’Œ tile2 åœ¨ tiles æ•°ç»„ä¸­çš„ç´¢å¼•
      [tiles[index1], tiles[index2]] = [tiles[index2], tiles[index1]];
      // äº¤æ¢è¿™ä¸¤ä¸ª tile åœ¨ tiles æ•°ç»„ä¸­çš„ä½ç½®
      renderTiles();
    }
    function checkWin() {
      const isCorrect = tiles.every((tile, index) => {
        return tile.dataset.index == index;
        // æ£€æŸ¥æ¯ä¸ª tile çš„ data-index å±æ€§æ˜¯å¦ä¸å…¶åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ç›¸åŒ
        // every æ–¹æ³•ç”¨äºæ£€æµ‹æ•°ç»„ä¸­ æ‰€æœ‰å…ƒç´  æ˜¯å¦éƒ½æ»¡è¶³ç»™å®šçš„æ¡ä»¶ã€‚

      });
      if (isCorrect) {
        message.textContent = 'ğŸ‰ æ­å–œä½ ï¼Œæ‹¼å›¾å®Œæˆï¼';
      } else {
        message.textContent = '';
      }
    }
    shuffleTiles();
  </script>
</body>

</html>